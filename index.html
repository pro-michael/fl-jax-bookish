<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title> Books & Beers - Reading List Submitions</title>
	<style>
		body { font-family: Arial, sans-serif; margin: 20px;}
		.search-container { margin-bottom: 20px; }
		.results, .cart { margin-top: 20px; }
		.book-item { display: flex; align-items: center; margin: 5px 0; }
		.book-item img { width: 50px; margin-right: 10px; }
		.overlay {
			display: none; position: fixed; top:0; left:0; width: 100%; height:100%;
			background: rgba(0,0,0,0.6); color: #fff; font-size: 24px;
			align-items: center; justify-content: center;
		}
	</style>
</head>
<body>
	<h1>FL Jax Bookish</h1>
	<h2>Beers & Books</h2>
	<p>What should we read next?</p>
	<p>Suggest up to 5 books for a reading list.</p>
	
	<div>
		<label for="username">What's Your Name?</label><br>
		<input type="text" id="username" placeholder="Enter your name" />
	</div>
	<br>
	
	<div class="search-container">
		<input type="text" id="search" placeholder="Search for a book..." />
		<div class="results" id="results"></div>
	</div>
	
	<h3>Your Suggestions:</h3>
	<div class="cart" id="cart"></div>
	<button id="submitBtn">Submit</button>
	
	<div class="overlay" id="overlay">Submitting your data...</div>
	
	<script>
		const resultsDiv = document.getElementById('results');
		const cartDiv = document.getElementById('cart');
		const overlay = document.getElementById('overlay');
		const cart = [];
		
		document.getElementById('search').addEventListener('input', async (e) => {
			const query = e.target.value.trim();
			if (query.length < 5) return; // wait until 5 chars
			const res = await fetch(`https://openlibrary.org/search.json?q=${encodeURIComponent(query)}`);
			const data = await res.json();
			resultsDiv.innerHTML = '';
			data.docs.slice(0,5).forEach(book => {
				const title = book.title;
				const author = book.author_name ? book.author_name[0] : 'unknown';
				const cover = book.cover_i ? `https://covers.openlibrary.org/b/id/${book.cover_i}-M.jpg` : '';
				
				const div = document.createElement('div');
				div.className = 'book-item';
				div.innerHTML = `
					${cover ? `<img src="${cover}">` : ''}
					<span>${title} - ${author}</span>
					<button>Add</button>
				`;
				div.querySelector('button').addEventListener('click', () => addToCart(title, author));
				resultsDiv.appendChild(div);
			});
		});
		
		function addToCart(title, author) {
			if (cart.length >=5) { alert("You can only add 5 books!"); return; }
			cart.push({title, author});
			renderCart();
		}
		
		function renderCart() {
			cartDiv.innerHTML = '';
			cart.forEach((b, i) => {
				const div = document.createElement('div');
				div.innerHTML = `${b.title} - ${b.author} <button>X Remove</button>`;
				div.querySelector('button').addEventListener('click', () => {
					cart.splice(i,1);
					renderCart();
				});
				cartDiv.appendChild(div);
			});
		}
		
		document.getElementById('submitBtn').addEventListener('click', async () =>{
			const name = document.getElementById('username').value.trim();
			if (!name) { alert("Please enter your name before submitting."); return; }
			if (cart.length === 0) { alert("Add at least one book!"); return; }

			overlay.innerText = "Submitting your data...";
			overlay.style.display = 'flex';
			
			for (let book of cart) {
				await fetch("https://script.google.com/macros/s/AKfycbwdJNaDbyEAkCDQs5J0OfjMhXZQC6twPfb6KCbs89HMBj-HbhCOAJi1nIcMbpHJDXfgBQ/exec", {
					method: "POST", 
					headers: { "Content-Type": "application/json" },
					body: JSON.stringify({
						title: book.title,
						author: book.author,
						name: name
					})
				});
			}

			overlay.innerText = `Confirmed, Books Received. Thanks for participating ${name}!`;
			setTimeout(() => overlay.style.display = 'none', 3000);
			cart.length = 0;
			renderCart();
			document.getElementById('username').value = '';
		});

	</script>
</body>
</html>


/* Google Sheets Web App URL */
/* https://script.google.com/macros/s/AKfycbwdJNaDbyEAkCDQs5J0OfjMhXZQC6twPfb6KCbs89HMBj-HbhCOAJi1nIcMbpHJDXfgBQ/exec */